<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<!-- 쿼리문 작성 -->
	<insert id="insert" parameterType="com.modang.vo.BoardVo">
		<![CDATA[
			insert into MatchBoard (
				  boardNo
				, userNo
			    , title
			    , matchGameType
			    , matchRegion
			    , membernum
			    , matchDate
			    , content
			    , boardDate)
			values (
				  seq_matchBoard_no.nextval
				, #{userNo}
				, #{title}
				, #{matchGameType}
				, #{matchRegion}
				, #{membernum}
				, TO_DATE(#{matchDate}, 'YYYY-MM-DD HH24:MI:SS')
				, #{content}
				, sysdate
			)
		]]>
	</insert>

	<select id="selectList" parameterType="map"
		resultType="com.modang.vo.BoardVo">
		<![CDATA[
			select ort.rn
			     , ort.boardno
			     , ort.title
			     , ort.matchgametype
			     , ort.matchregion
			     , ort.membernum
			     , ort.matchdate
			     , ort.content
			     , ort.boarddate
			     , ort.count
			     , ort.status
			     , ort.nick
			from (select rownum rn
			                  , ot.boardno
			                  , ot.title
			                  , ot.matchgametype
			                  , ot.matchregion
			                  , ot.membernum
			                  , ot.matchdate
			                  , ot.content
			                  , ot.boarddate
			                  , ot.count
			                  , ot.status
			                  , ot.nick
			     from (select mb.boardno
			                , mb.title
			                , mb.matchgametype
			                , mb.matchregion
			                , mb.membernum
			                , mb.matchdate
			                , mb.content
			                , mb.boarddate
			                , mb.count
			                , mb.status
			                , u.nick
			          from matchboard mb, users u
			          where mb.userNo = u.userNo 
           	]]>
				<if test='category == "title" and keyword != "" and keyword != null'>
					and mb.title like '%'|| #{keyword} ||'%'
				</if>
				<if test='category == "matchregion" and keyword != null and keyword != ""'>
		            and mb.matchregion like '%'|| #{keyword} ||'%'
		        </if>
		        <if test='category == "nick" and keyword != null and keyword != ""'>
		            and u.nick like '%'|| #{keyword} ||'%'
		        </if>
		         <!-- matchgametype에 대한 조건을 추가 -->
		        <if test='category == "matchgametype" and matchgametypeValue != null and matchgametypeValue != -1'>
		            and mb.matchgametype in (#{matchgametypeValue})
		        </if>
		        <if test='category == "matchgametype" and matchgametypeValue == -1'>
		            and mb.matchgametype in (0,1)
		        </if>
		        <if test='category == "content" and keyword != null and keyword != ""'>
		            and mb.content like '%'|| #{keyword} ||'%'
		        </if>
			<![CDATA[	
            		 order by mb.matchdate asc
			          ) ot
			    ) ort
			where rn >= #{startRnum}
			and rn <= #{endRnum}
		]]>
	</select>
	<select id="totalCount" parameterType="map" resultType="int">
        <![CDATA[
            select count(*)
            from matchboard mb, users u
            where mb.userno = u.userno
        ]]>
        <if test='category == "title" and keyword != "" and keyword != null'>
			and mb.title like '%'|| #{keyword} ||'%'
		</if>
		<if test='category == "matchregion" and keyword != null and keyword != ""'>
            and mb.matchregion like '%'|| #{keyword} ||'%'
        </if>
        <if test='category == "nick" and keyword != null and keyword != ""'>
            and u.nick like '%'|| #{keyword} ||'%'
        </if>
       	<if test='category == "matchgametype" and matchgametypeValue != null and matchgametypeValue != -1'>
            and mb.matchgametype in (#{matchgametypeValue})
        </if> 
        <if test='category == "matchgametype" and matchgametypeValue == -1'>
            and mb.matchgametype in (0,1)
        </if> 
        <if test='category == "content" and keyword != null and keyword != ""'>
            and mb.content like '%'|| #{keyword} ||'%'
        </if>
		<![CDATA[
		]]>
	</select>
	
	<select id="selectOne" parameterType="int" resultType="com.modang.vo.BoardVo">
		<![CDATA[
			select mb.boardNo,
			       mb.title,
			       mb.matchgametype,
			       mb.matchregion,
			       mb.memberNum,
			       mb.matchdate,
			       mb.content,
			       mb.boardDate,
			       mb.count,
			       mb.status,
			       u.nick,
			       u.userNo
			from Matchboard mb, users u
			where mb.boardNo = #{boardNo} and u.userNo = mb.userNo
		]]>
	</select>
</mapper>
